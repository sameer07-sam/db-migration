"""
Migration script to transfer data from MySQL to PostgreSQL.
Make sure both databases are accessible and schemas are created before executing.
"""

import mysql.connector
import psycopg2

# MySQL credentials (replace with your actual credentials)
mysql_config = {
    'host': 'localhost',
    'user': 'mysql_user',         # Your MySQL username
    'password': 'mysql_password', # Your MySQL password
    'database': 'mysql_db'        # Your MySQL database name
}

# PostgreSQL credentials (replace with your actual credentials)
postgres_config = {
    'host': 'localhost',
    'user': 'postgres_user',          # Your PostgreSQL username
    'password': 'postgres_password',  # Your PostgreSQL password
    'dbname': 'postgres_db'           # Your PostgreSQL database name
}

def fetch_mysql_data():
    """Fetch all user data from MySQL."""
    conn = mysql.connector.connect(**mysql_config)
    cursor = conn.cursor()
    cursor.execute("SELECT id, name, email FROM users")
    data = cursor.fetchall()
    cursor.close()
    conn.close()
    return data

def insert_postgres_data(data):
    """Insert user data into PostgreSQL."""
    conn = psycopg2.connect(**postgres_config)
    cursor = conn.cursor()
    cursor.execute("DELETE FROM users")  # Clear table before inserting (optional)
    for row in data:
        cursor.execute("INSERT INTO users (id, name, email) VALUES (%s, %s, %s)", row)
    conn.commit()
    cursor.close()
    conn.close()

if __name__ == "__main__":
    # Step 1: Fetch data from MySQL
    data = fetch_mysql_data()
    print(f"Fetched {len(data)} rows from MySQL.")

    # Step 2: Insert into PostgreSQL
    insert_postgres_data(data)
    print(f"Migrated {len(data)} rows to PostgreSQL.")